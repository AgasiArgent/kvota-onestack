{
  "version": "2.0",
  "created": "2025-01-16",
  "project": "OneStack Workflow Extension",

  "config": {
    "max_iterations": 10,
    "max_fix_attempts": 5,
    "git_commit_every": 2,
    "severity_order": ["critical", "high", "medium", "low"],
    "protected_files": [
      "calculation_engine.py",
      "calculation_models.py"
    ],
    "protected_files_note": "NEVER modify these files - calc engine is frozen and verified against Excel reference"
  },

  "phases": {
    "pytest": {
      "enabled": true,
      "command": "source venv/bin/activate && pytest tests/ -v --tb=short 2>&1",
      "timeout_seconds": 300
    },
    "browser_ui": {
      "enabled": true,
      "app_start_command": "python main.py",
      "app_url": "http://localhost:5001",
      "flows": [
        {"name": "login", "path": "/login", "checks": ["form", "submit"]},
        {"name": "dashboard", "path": "/dashboard", "checks": ["stats", "nav"]},
        {"name": "quotes", "path": "/quotes", "checks": ["list", "create_button"]},
        {"name": "procurement", "path": "/procurement", "checks": ["workspace", "dropdowns"]},
        {"name": "calculation", "path": "/quotes/{id}/calculate", "checks": ["form", "htmx"]}
      ]
    }
  },

  "context_optimization": {
    "use_background_tasks": true,
    "results_dir": ".claude/autonomous/ui-test-results",
    "screenshots_dir": ".claude/autonomous/screenshots",
    "prefer_snapshots_over_screenshots": true
  },

  "test_categories": [
    {
      "name": "unit_services",
      "description": "Unit tests for service layer",
      "pattern": "tests/test_services*.py",
      "priority": 1
    },
    {
      "name": "ui_components",
      "description": "UI component unit tests (FastHTML)",
      "pattern": "tests/test_ui*.py",
      "priority": 2
    },
    {
      "name": "api_endpoints",
      "description": "API endpoint tests",
      "pattern": "tests/test_api*.py",
      "priority": 3
    },
    {
      "name": "integration",
      "description": "Integration tests",
      "pattern": "tests/test_integration*.py",
      "priority": 4
    }
  ],

  "exit_conditions": {
    "success": "All pytest pass AND all browser UI flows pass",
    "timeout": "Iteration count exceeds max_iterations",
    "stuck": "Same bug fails to fix after max_fix_attempts attempts"
  }
}
