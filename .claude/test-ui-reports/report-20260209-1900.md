# Browser Test Report

**Timestamp:** 2026-02-09T19:21:00
**Session:** 2026-02-09 #8
**Base URL:** https://kvotaflow.ru
**Overall:** 2/3 PASS

---

## Task: [86af6ykgu] Spec Dashboard columns (СУММА/ПРОФИТ)
**URL:** /dashboard?tab=spec-control
**Status:** PASS

| # | Check | Result | Details |
|---|-------|--------|---------|
| 1 | Navigate to /spec-control | PASS | Redirects to /dashboard?tab=spec-control, page loads correctly |
| 2 | СУММА column visible | PASS | Visible in "Спецификации на проверке" and "Подписанные спецификации" tables |
| 3 | ПРОФИТ column visible | PASS | Visible in both spec tables alongside СУММА |
| 4 | Numeric values displayed | PASS | Q-202602-0044 shows СУММА=$2,232, ПРОФИТ=$228 — real calculated values |
| 5 | Итого summary row | PASS | "Итого: $35,704 | Профит: $2,081" displayed at top of page |
| 6 | Values not NaN/zero | PASS | Values are realistic numeric amounts with currency symbols |
| 7 | Console errors | PASS | Only 2 pre-existing theme-related JS errors (updateThemeIcon, addEventListener null) |

**Console Errors:** 2 pre-existing (theme icon related, not blocking)
**Screenshots:** initial-load-spec-control, scrolled-spec-tables, signed-spec-with-values

---

## Task: [86af6ykgg] МОТ customs licenses (ДС/СС/СГР)
**URL:** /customs/65550a57-03af-495f-bed1-f2d316c23d88 (via /dashboard?tab=customs → "Работать")
**Status:** PASS

| # | Check | Result | Details |
|---|-------|--------|---------|
| 1 | Navigate to /dashboard?tab=customs | PASS | Таможня dashboard loads, shows 1 quote "Ожидает таможни" |
| 2 | Open customs workspace | PASS | Clicked "Работать" on Q-202601-0039, customs page loaded |
| 3 | Handsontable items table visible | PASS | "ТАМОЖНЯ ПО ПОЗИЦИЯМ (2 ПОЗИЦИЙ)" section with 2 items |
| 4 | 6 new license columns exist | PASS | Columns visible: ДС, СТ-ТЬ ДС, СС, СТ-ТЬ СС, СГР, СТ-ТЬ СГР |
| 5 | ДС checkbox toggles | PASS | Clicked checkbox on row 1 — turned blue (checked) |
| 6 | СТ-ТЬ ДС cost editable | PASS | Double-clicked cell, entered 1500, Tab moved to next cell, value shows 1500.00 |
| 7 | "Сохранить данные" button exists | PASS | Button visible below table, clicked successfully |
| 8 | Save persists data | PASS | Page reloaded after save, ДС checkbox still checked, СТ-ТЬ ДС=1500.00 persisted |
| 9 | RUB footnote visible | PASS | "* Стоимость лицензий (ДС, СС, СГР) указана в рублях (RUB)" shown below table |
| 10 | Console errors | PASS | Only 2 pre-existing theme-related JS errors |

**Console Errors:** 2 pre-existing (same theme errors as other pages)
**Screenshots:** customs-dashboard, customs-workspace-table, checkbox-checked, cost-entered, after-save

**Note:** Test data left on Q-202601-0039: ДС=checked, СТ-ТЬ ДС=1500.00 on row 1 (Товар1)

---

## Task: [86af6ykc7] Supplier-Brands UI
**URL:** /suppliers/51db97f1-a994-45d3-b49b-d3e859d00502?tab=brands
**Status:** FAIL

| # | Check | Result | Details |
|---|-------|--------|---------|
| 1 | Navigate to /suppliers | PASS | Suppliers list loads with 5 suppliers |
| 2 | Open supplier detail | PASS | Clicked "Test Supplier Company", detail page loaded |
| 3 | "Бренды" tab exists | PASS | Tab visible alongside "Общая" tab |
| 4 | Click "Бренды" tab | PASS | Tab content loads, URL changes to ?tab=brands |
| 5 | No duplicate tabs on load | PASS | Only "Общая" and "Бренды" tabs, no HTMX duplication |
| 6 | Empty state message | PASS | "Бренды не привязаны к этому поставщику." displayed |
| 7 | "Добавить бренд" form | PASS | Input "Название бренда" + "Основной" checkbox + button visible |
| 8 | Submit brand (POST) | FAIL | POST /suppliers/{id}/brands returns 200 OK but brand NOT saved to database |
| 9 | Brand appears in list | FAIL | After page reload, still shows empty state — brand not persisted |
| 10 | Delete brand | SKIP | Cannot test — no brands to delete (add fails) |
| 11 | Console errors | PASS | Only 2 pre-existing theme-related JS errors |

**Console Errors:** 2 pre-existing (same theme errors)
**Screenshots:** suppliers-list, supplier-detail, brands-tab-empty, after-add-attempt, after-reload-still-empty

**BUG DETAILS:**
- **What:** Adding a brand via "Добавить бренд" button does not persist the brand
- **Expected:** Brand "TestBrand" should appear in the brands list after clicking "Добавить бренд"
- **Actual:** POST to /suppliers/{id}/brands returns HTTP 200, but after full page reload, brands list is still empty ("Бренды не привязаны к этому поставщику.")
- **Reproduction:**
  1. Go to /suppliers/{any_supplier_id}?tab=brands
  2. Type brand name in "Название бренда" input
  3. Click "+ Добавить бренд"
  4. POST returns 200 but HTMX doesn't update the list
  5. Refresh page — brands list still empty
- **Likely cause:** POST handler returns 200 but either (a) doesn't actually insert into DB, or (b) inserts with wrong supplier_id/organization_id, or (c) the GET query to list brands doesn't match what was inserted

---

## Console Errors (all tasks)
All pages share the same 2 pre-existing JavaScript errors (not related to any tested feature):

1. `TypeError: Cannot read properties of null (reading 'addEventListener')` — line 2592
2. `ReferenceError: text is not defined` at `updateThemeIcon` — line 2529

These are theme toggle related and non-blocking.

---

## Summary for Terminal 1
PASS: 86af6ykgu (Spec Dashboard columns), 86af6ykgg (МОТ customs licenses)
FAIL: 86af6ykc7 (Supplier-Brands UI — brand add POST returns 200 but data not persisted)
ACTION: Fix supplier brands POST handler — investigate why brand is not saved to DB despite 200 response
